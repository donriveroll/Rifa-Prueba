<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Rifa Numismática</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; padding: 20px; }
    #boletos { display: grid; grid-template-columns: repeat(10, 1fr); gap: 5px; max-width: 400px; margin: 20px auto; }
    .boleto { padding: 10px; border: 1px solid #333; cursor: pointer; border-radius: 5px; }
    .seleccionado { background-color: #4CAF50; color: white; }
    .ocupado { background-color: #ccc; color: #666; cursor: not-allowed; }
    form { margin-top: 20px; }
    input, button { margin: 5px; padding: 8px; }
  </style>
</head>
<body>
  <h1>Rifa Numismática</h1>
  <p>Selecciona tus boletos:</p>

  <div id="boletos"></div>

  <form id="formulario">
    <input type="text" id="nombre" placeholder="Tu nombre" required>
    <input type="tel" id="telefono" placeholder="Tu teléfono" required>
    <button type="submit">Reservar</button>
  </form>

  <p id="mensaje"></p>

  <script>
    const contenedor = document.getElementById("boletos");
    const seleccionados = new Set();

    // Generar boletos del 00 al 99
    for (let i = 0; i < 100; i++) {
      const num = i.toString().padStart(2, "0");
      const div = document.createElement("div");
      div.textContent = num;
      div.classList.add("boleto");
      div.addEventListener("click", () => {
        if (!div.classList.contains("ocupado")) {
          if (seleccionados.has(num)) {
            seleccionados.delete(num);
            div.classList.remove("seleccionado");
          } else {
            seleccionados.add(num);
            div.classList.add("seleccionado");
          }
        }
      });
      contenedor.appendChild(div);
    }

    // Manejo del formulario
    document.getElementById("formulario").addEventListener("submit", function(e) {
      e.preventDefault();

      if (seleccionados.size === 0) {
        alert("Por favor selecciona al menos un boleto");
        return;
      }

      const data = {
        boletos: Array.from(seleccionados).join(", "),
        nombre: document.getElementById("nombre").value,
        telefono: document.getElementById("telefono").value
      };

      fetch("https://script.google.com/macros/s/AKfycbxWbgI5IcOqbGx7LPj5XtVj7e5-aVJ4Ft2pyhSg228mNvlVpxxlq-wk8CzqbGg7uhoT/exec", {
        method: "POST",
        body: JSON.stringify(data),
        headers: {
          "Content-Type": "application/json"
        }
      })
      .then(r => r.json())
      .then(resp => {
        if (resp.status === "OK") {
          document.getElementById("mensaje").textContent = "✅ Tus boletos fueron reservados y guardados.";
          seleccionados.forEach(num => {
            const div = [...contenedor.children].find(d => d.textContent === num);
            if (div) {
              div.classList.remove("seleccionado");
              div.classList.add("ocupado");
            }
          });
          seleccionados.clear();
          document.getElementById("formulario").reset();
        } else {
          document.getElementById("mensaje").textContent = "⚠️ Error al guardar: " + resp.message;
        }
      })
      .catch(err => {
        console.error("Fetch error:", err);
        document.getElementById("mensaje").textContent = "⚠️ No se pudo conectar con Google Sheets.";
      });
    });
  </script>
</body>
</html>